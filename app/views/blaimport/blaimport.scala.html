@(message: String)(implicit flash: Flash)

@main(message, CBLAFileUpload.NAV) {

    <script type="text/javascript">
        var error=undefined;
    </script>

    <div class="page-header" >
        <h1>Planungsdatei importieren</h1>
    </div>

    <div class="row-fluid">
        <div class="co-md-9">
                @helper.form(action = routes.CBLAFileUpload.uploadFile(), 'enctype -> "multipart/form-data") {
                    <div class="form-inline @("has-error".when(flash.get("error"))) @("has-success".when(flash.get("success")))">


                        <div class="form-group">
                            @if(flash.get("error")) {
                                <label class="control-label" for="uploadBtn">@flash.get("error")</label>
                                <script type="text/javascript">
                                $ ( window ).on ( 'load', function ( ) {
                                $ ( '#progressBarContainer' ).removeClass ( 'hidden' ) ;
                                } ) ;
                                error=true;
                                </script>
                            }
                            @if(flash.get("success")) {
                                <label class="control-label" for="uploadBtn">@flash.get("success")</label>
                                <script type="text/javascript">
                                $ ( window ).on ( 'load', function ( ) {
                                $ ( '#progressBarContainer' ).removeClass ( 'hidden' ) ;
                                } ) ;
                                error=false;
                                </script>
                            }
                            <div class="form-group">
                                <input id="uploadBtn" class="form-control btn btn-info " type="file" name="fileUpload" title="Datei AuswÃ¤hlen" accept="application/bla, .bla">
                            </div>
                        </div>
                        <div class="form-group">
                            <input class="btn btn-success form-control" type="submit" value="Upload">
                        </div>
                    </div>
                }
                <br/>
                <div id="progressBarContainer" class="hidden col-md-5">

                    <div id="progressBar" class="progress progress-striped active">
                        <div class="progress-bar progress-bar-warning " role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width : 100%">
                            <span class="sr-only">100% Complete</span>
                        </div>
                    </div>

                </div>

            <div class="alert alert-danger col-md-5 hidden" id="errorContainer">

            </div>

          </div>
    </div>
    <script type="text/javascript">

    var startPolling = function ( ) {
    var poll = function ( ) {

    $.ajax ( "/blaimportFinished", {

         dataType: "json",
        success : function ( data ) {
            if ( data.result == true ) {
            changeProgressBar ( ) ;
                if(data.error){

                $.getJSON('@routes.CBLAFileUpload.errorMessage' , function(exData){
        $('#errorContainer' ).removeClass('hidden' ).html(exDate.html);

    } );

                }
            } else {
             setTimeout ( poll, 2000 ) ;
            }
        }
    } ) ;

    };

    poll ( ) ;

    };

    var changeProgressBar = function ( ) {
    //$ ( '#progressBar' ).removeClass ( 'active' ) ;
    $ ( '.progress-bar' ).removeClass ( 'progress-bar-warning' ).addClass ( 'progress-bar-success' ) ;

    };

    $ ( window ).on ( 'load', function ( ) {
        if(undefined != error) {
            if ( ! error ) {
            startPolling ( ) ;
            } else {
            $ ( '.progress-bar' ).removeClass ( 'progress-bar-warning' ).addClass ( 'progress-bar-danger' ) ;
            }
        }
    });

    </script>

}