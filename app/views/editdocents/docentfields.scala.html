@(existingDocentForm: Form[fhs.pages.editdocents.MExistingDocent], houses: List[persistence.location.HouseEntity], rooms: List[persistence.location.RoomEntity])(implicit flash:Flash)

@import models.fhs.pages.editdocents._


@import models.fhs.pages.roomdefinition._

@import helper._
@import helper.twitterBootstrap._

    @defaultDocent = @{
        MExistingDocent(-1, "", List[MTimeslotCriteria](), List[Long](), List[String](), List[Long]())
    }

<form id="editDocentForm" class="form-inline">
    <a class="btn btn-danger btn-sm pull-right" role="button" href="@routes.CEditDocents.deleteDocent(existingDocentForm.value.getOrElse(defaultDocent).id) "><span class="glyphicon glyphicon-minus"></span> </a>
    @inputText(existingDocentForm("id"), '_class -> "hidden")
    @inputText(existingDocentForm("lastName"), '_label -> "Nachname", '_class -> "form-group", '_help -> "")
    <br/>
    <div class="form-group">
        <label class="control-label" for="favoriteFacility">Bevorzugte Gebäude</label>
        <select multiple id="favoriteFacility" name="houseCriterias[]" title="nichts ausgewählt">

        @for(h <- houses) {
            @defining(existingDocentForm.value.getOrElse( defaultDocent).houseCriterias.count(houseId => houseId.equals(h.getId)) > 0) { isSelected =>
                <option value="@h.getId" @if(isSelected) { selected }>@h.getName </option>
            }
        }
        </select>
    </div>
    <div class="form-group">
        <label for="favoriteRooms" class="control-label">Bevorzugte Räume</label>
        <select multiple id="favoriteRooms" name="roomCrit[]" data-selected-text-format="count>4" title="nichts ausgewählt">
        @for(r <- rooms) {
            @defining(existingDocentForm.value.getOrElse(defaultDocent).roomCrit.count(_ == r.getId) > 0) { isSelected =>
                <option value="@r.getId" @if(isSelected) { selected }>@r.getHouse.getName @r.getNumber </option>
            }
        }
        </select>
    </div>
    <div class="form-group">
        <label class="control-label" for="favoriteAttributes">Bevorzugte Ausstattung</label>
        <select id="favoriteAttributes" name="roomAttr[]" multiple title="nichts ausgewählt">
        @for(attr <- MRoomdefintion.ATTRIBUTES) {
            @defining(existingDocentForm.value.getOrElse(defaultDocent).roomAttr.count(_ == attr)>0) { isSelected =>
                <option @if(isSelected){selected } value="@attr">@attr</option>
            }
        }
        </select>
    </div>
    <div id="timeCrits">
    @repeat(existingDocentForm("timeslots"), min = 0) { timeslotCrit =>
        <div class="panel panel-info" id="@timeslotCrit.id">
            <button id="remove_@timeslotCrit.id" role="button" class="pull-right btn btn-sm btn-danger"><span class="glyphicon glyphicon-minus"></span></button>
            <div class="form-group">
                <label class="control-label">darf abweichen</label>
                <div class="form-group">
                    <label>
                        <input type="radio" class="form-control" @if(timeslotCrit("tolerant").value.getOrElse("true") == "true") {
                        checked } name="@timeslotCrit("tolerant").name" value="true"/>
                        Ja
                    </label>
                </div>
                <div class="form-group">
                    <label>
                        <input type="radio" class="form-control"  @if(timeslotCrit("tolerant").value.getOrElse("true") == "false") {
                        checked } name="@timeslotCrit("tolerant").name" value="false"/>
                        Nein
                    </label>
                </div>
            </div>
            <h4>Beginn:</h4>

            @select(timeslotCrit("startHour"), (0 to 23).toSeq.map(i => (i.toString, i.formatted("%02d"))), '_class -> "form-group ", '_label -> "Stunde", '_help -> "")
            @select(timeslotCrit("startMinute"), (0 to 59 by 5).toSeq.map(i => (i.toString, i.formatted("%02d"))), '_class -> "form-group ", '_label -> "Minute", '_help -> "")

            <h4>Ende:</h4>

            @select(timeslotCrit("stopHour"), (0 to 23).toSeq.map(i => (i.toString, i.formatted("%02d"))), '_class -> "form-group ", '_label -> "Stunde", '_help -> "")
            @select(timeslotCrit("stopMinute"), (0 to 59 by 5).toSeq.map(i => (i.toString, i.formatted("%02d"))), '_class -> "form-group ", '_label -> "Minute", '_help -> "")
            <div class="clearfix"></div>
            @select(timeslotCrit("weekday"), CTimeslotDefintion.WEEKDAYS, '_class -> "form-group", '_label->"Wochentag")

        </div>
        <script>
        $ ( '#remove_@timeslotCrit.id').on('click', function(e){
        $ ( '#@timeslotCrit.id').remove();
        } ) ;
        </script>
    }

    </div>
    <br />
    <div class="form-group">
        <button type="button" id="addTimeCrit" class="btn btn-sm btn-warning" role="button"><span class="glyphicon glyphicon-plus"></span> </button>
    </div>
    <div class="clearfix"></div>
    <br />
    <div class="form-group">
        <div class="form-group">
            <button class="form-control btn btn-success" type="submit"> <span class="glyphicon glyphicon-ok"></span> </button>
        </div>
        <div class="form-group">
            <button class="form-control btn btn-danger" type="reset"><span class="glyphicon glyphicon-remove"></span> </button>
        </div>
    </div>

</form>
    @if(flash.get("submitResult").getOrElse("").equals("true")){
    <div class="alert alert-success"> <span class="glyphicon glyphicon-thumbs-up"></span> Erfolg </div>
    }
   @if(flash.get("submitResult").getOrElse("").equals("false")){
    <div class="alert alert-danger"> <span class="glyphicon glyphicon-thumbs-down"></span> Fehler </div>
   }
<script >
 initSelect();

 index=@existingDocentForm.value.getOrElse(defaultDocent).timeslots.length;
    $('#addTimeCrit' ).on('click', function(e){
    $.getJSON('/timeCritFields/' + index, function(data){
      $('#timeCrits' ).append(data.htmlresult);
      initSelect ();
     });

    index++;
});

$ ( '#editDocentForm' ).on ( 'submit', function ( e ) {

var postData = $ ( this ).serialize ( ) ;
var postUrl = "@routes.CEditDocents.editDocent";
var form = $ ( this ) ;

$.ajax ( {
url : postUrl,
type : "POST",
data : postData,
contentType : form.attr ( "enctype" ),
success : function ( data, textStatus, jqXHR ) {
$ ( '#docentFields' ).empty ( ).append ( data.htmlresult ) ;
},
error : function ( jqXHR, textStatus, errorThrown ) {
$ ( '#docentFields' ).empty ( ).append ( '<div class="alert alert-danger"> <span class="glyphicon glyphicon-thumbs-down" />' + errorThrown + ' </div> ' )
}
} ) ;
e.preventDefault ( ) ;
//e.unbind(); //unbind. to stop multiple form submit.
} ) ;
</script>