@(title:String,courseNames:List[String],timeRanges: List[models.fhs.pages.basicstuctures.TimeRange], timeslots: List[models.persistence.scheduletree.TimeSlot], semester:models.persistence.Semester)(implicit session:Session)

@import models.persistence.lecture.Lecture
@import models.fhs.pages.JavaList

@import models.persistence.scheduletree.Weekday
@import models.persistence.enumerations.EDuration

@main(title,CLocalSchedule.NAV){

    @defining(CTimeslotDefintion.WEEKDAYS.filter{
        case (sortIndexString,dayname)=>
            val sortIndex=sortIndexString.toInt
            !timeslots.find(_.getParent.asInstanceOf[Weekday].getSortIndex.toInt == sortIndex).isEmpty
    }.sortBy(_._1)) { days=>

            <div class="form-inline">
                <div class="form-group">
                    <select id="courseSelect">
                        @courseNames.map{ name=>
                            <option value="@name">@name</option>
                        }
                    </select>
                </div>
            </div>
        <div class="form-inline">
            <div class="form-group">
                Legende:
            </div>
            <div class="form-group">
                <div class="showcase panel-info">
                    <div class="bg-info showcase-content">w</div>
                </div>
            </div>
            <div class="form-group">
                <div class="showcase">
                    <div class=" bg-warning showcase-content">g</div>
                </div>
            </div>
            <div class="form-group">
                <div class="showcase">
                    <div class="bg-primary showcase-content">ug</div>
                </div>
            </div>
            <div class="form-group">
                <div class="showcase">
                    <span class="glyphicon glyphicon-book"></span> V
                </div>
            </div>
            <div class="form-group">
                <div class="showcase">
                    <span class="glyphicon glyphicon-hdd"></span> Ãœ
                </div>
            </div>
        </div>
<div class="clearfix"></div>
        <table class="table table-bordered table-striped table-condensed">
            <caption class="caption"> <h3> @semester.getName </h3></caption>
            <thead>
                <tr>
                    <th class="text-info text-center" >Uhrzeit</th>


                    @for(day <- days) {
                        <th class="text-info text-center" > @day._2</th>
                    }

                </tr>
            </thead>
            <tbody>
            @for(range <- timeRanges.sorted) {
                <tr>
                    <td class="text-center" style=" vertical-align : middle ; width : 8% ;" >
                    @range.toString
                    </td>
                    @for(day <- days) {
                        <td >

                        @defining(timeslots.toSet.filter(slot => range.compare(slot) == 0 && slot.getParent.asInstanceOf[Weekday].getSortIndex.toInt == day._1.toInt)) { relevantSlots =>
                            @defining(relevantSlots.flatMap(_.getLectures.asInstanceOf[JavaList[Lecture]].toList).toList.sortBy { l => (if(l.getDuration == EDuration.WEEKLY) {
                                0
                            } else {
                                -relevantSlots.map(_.getLectures.count(_.getDocents.contains(l.getDocents.head))).sum
                            }, l.getDocents.head.getLastName)
                            }) { lectures =>
                                @for(idx<- 0 to (lectures.length - 1)){
                                    @displayLecture(lectures(idx))
                                }
                            }
                        }
                </td>
                    }
                    }
            </tbody>
        </table>
      <script>
      var courseChange = function(){
          $('.lecture').addClass("hidden");
          $('.' + $('#courseSelect').val()).removeClass('hidden');
          };
          $('#courseSelect').change(courseChange);
          $('#courseSelect').val($('#courseSelect').first().val());
          courseChange();
      </script>
    }
}